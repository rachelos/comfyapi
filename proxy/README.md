# 上网代理服务器使用说明

## 简介

这是一个功能强大的HTTP/HTTPS代理服务器，支持以下特性：

- 支持HTTP和HTTPS代理
- 支持所有主要HTTP方法（GET, POST, PUT, DELETE等）
- SSL隧道连接（CONNECT方法）
- IP白名单和黑名单访问控制
- 目标域名和IP过滤
- 响应缓存功能
- 匿名模式（隐藏客户端信息）
- 详细的日志记录
- 代理状态监控

## 快速开始

### 基本代理服务器

运行基本版本的代理服务器：

```bash
python proxy.py
```

默认监听在 `localhost:6777`。

### 增强版代理服务器

运行增强版本的代理服务器（推荐）：

```bash
python enhanced_proxy.py
```

增强版本提供了更多功能和更好的性能。

### 命令行参数

两个版本都支持以下命令行参数：

- `--host`: 指定监听的主机地址（默认：0.0.0.0，监听所有网络接口）
- `--port`: 指定监听的端口（默认：6777）
- `--verbose`: 启用详细日志记录
- `--timeout`: 连接超时时间（秒）（仅增强版）
- `--config`: 指定配置文件路径（仅增强版）

示例：

```bash
python enhanced_proxy.py --host 127.0.0.1 --port 8080 --verbose
```

## 配置文件

增强版代理服务器支持通过 `config.py` 文件进行配置。您可以修改以下设置：

### 服务器设置

```python
SERVER_CONFIG = {
    'host': '0.0.0.0',  # 监听所有网络接口
    'port': 6777,       # 默认端口
    'timeout': 30,      # 连接超时时间（秒）
    'max_connections': 100,  # 最大并发连接数
}
```

### 访问控制

```python
ACCESS_CONTROL = {
    'enable_whitelist': False,  # 是否启用白名单
    'whitelist': [              # IP白名单
        '127.0.0.1',
        '192.168.1.0/24',
    ],
    'enable_blacklist': False,  # 是否启用黑名单
    'blacklist': [],            # IP黑名单
}
```

### 目标过滤

```python
TARGET_FILTER = {
    'blocked_domains': [        # 被阻止的域名列表
        # 'example.com',
        # 'blocked-site.com',
    ],
    'blocked_ips': [            # 被阻止的IP列表
        # '1.2.3.4',
    ],
}
```

### 日志设置

```python
LOGGING = {
    'level': 'INFO',            # 日志级别: DEBUG, INFO, WARNING, ERROR, CRITICAL
    'log_to_file': False,       # 是否记录到文件
    'log_file': 'proxy.log',    # 日志文件名
    'log_format': '%(asctime)s - %(levelname)s - %(message)s',  # 日志格式
}
```

### 高级设置

```python
ADVANCED = {
    'enable_cache': False,      # 是否启用缓存
    'cache_size': 100,          # 缓存大小（MB）
    'enable_compression': False, # 是否启用压缩
    'anonymous_mode': True,     # 匿名模式（不发送真实IP）
}
```

## 在浏览器中使用

1. 打开浏览器设置
2. 找到网络或代理设置
3. 配置HTTP代理为 `localhost:6777`（或您指定的主机和端口）
4. 保存设置并开始浏览

## 在应用程序中使用

大多数应用程序都支持HTTP代理设置。通常，您需要在应用程序的设置或首选项中找到网络或代理设置，然后配置HTTP代理为 `localhost:6777`（或您指定的主机和端口）。

## 监控代理状态

访问以下URL查看代理服务器的状态：

```
http://localhost:6777/proxy-status
```

这将显示服务器的运行状态、配置信息和缓存统计（如果启用了缓存）。

## 安全注意事项

- 默认情况下，代理服务器监听所有网络接口（0.0.0.0）。如果您只需要在本地使用，请将主机设置为 `127.0.0.1`。
- 如果您的代理服务器可以从互联网访问，强烈建议启用IP白名单或黑名单来限制访问。
- 匿名模式可以帮助保护您的隐私，但不能保证完全匿名。
- 请遵守当地法律和网站的使用条款。

## 故障排除

### 代理服务器无法启动

- 检查端口是否已被其他应用程序占用
- 确保您有足够的权限绑定到指定的端口
- 检查配置文件是否有语法错误

### 无法连接到代理服务器

- 确保代理服务器正在运行
- 检查您配置的主机和端口是否正确
- 检查防火墙设置是否阻止了连接

### 某些网站无法访问

- 检查目标过滤设置
- 某些网站可能会检测并阻止代理服务器
- 尝试启用或禁用匿名模式

## 高级用法

### 作为正向代理

默认情况下，代理服务器作为正向代理运行，将客户端请求转发到目标服务器。

### 作为反向代理

您可以修改代码，使其作为反向代理运行，将请求转发到特定的后端服务器。

### 作为负载均衡器

通过修改代码，您可以实现简单的负载均衡功能，将请求分发到多个后端服务器。

## 许可证

本代理服务器是自由软件，您可以根据需要自由使用、修改和分发。